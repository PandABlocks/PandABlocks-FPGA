<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PCAP - Position Capture &mdash; PandABlocks-FPGA 4.1b1-2-g16147d6
 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
      <link rel="stylesheet" type="text/css" href="../_static/theme_overrides.css" />

  
    <link rel="shortcut icon" href="../_static/PandA-logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PCOMP - Position Compare" href="pcomp_doc.html" />
    <link rel="prev" title="OUTENC - Output encoder" href="outenc_doc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >

          
          
          <a href="../index.html" class="icon icon-home">
            PandABlocks-FPGA
              <img src="../_static/PandA-logo-for-black-background.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                4.1b1-2-g16147d6

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  <style>
    /* style mobile top nav to look like main nav */
    .wy-nav-top {
        background: black
    }
  </style>
  
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">What can PandABlocks do?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#how-is-the-documentation-structured">How is the documentation structured?</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#using-an-existing-pandablocks-device">Using an existing PandABlocks device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#generating-a-new-set-of-blocks-for-a-pandablocks-device">Generating a new set of Blocks for a PandABlocks device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#extending-the-functionality-of-a-pandablocks-device">Extending the functionality of a PandABlocks device</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#working-on-the-core-autogeneration-framework">Working on the core autogeneration framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial1_blinking_leds.html">Blinking LEDs Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial2_position_capture.html">Position Capture Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial3_position_compare.html">Position Compare Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial4_snake_scan.html">Snake Scan Tutorial</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../blocks.html">Available Blocks</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="absenc_doc.html">ABSENC - Absolute encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="bits_doc.html">BITS - Soft inputs and constant bits</a></li>
<li class="toctree-l4"><a class="reference internal" href="calc_doc.html">CALC - Position Calc</a></li>
<li class="toctree-l4"><a class="reference internal" href="clock_doc.html">CLOCK - Configurable clock</a></li>
<li class="toctree-l4"><a class="reference internal" href="counter_doc.html">COUNTER - Up/Down pulse counter</a></li>
<li class="toctree-l4"><a class="reference internal" href="div_doc.html">DIV - Pulse divider</a></li>
<li class="toctree-l4"><a class="reference internal" href="equ_doc.html">EQU - EQU Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="filter_doc.html">FILTER - Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_24v_doc.html">FMC_24V - FMC 24V IO Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_acq427_doc.html">FMC_ACQ427 - FMC ACQ427 Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_acq430_doc.html">FMC_ACQ430 - FMC ACQ430 Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_loopback_doc.html">FMC_LOOPBACK - FMC Loopback Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="incenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="inenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="lut_doc.html">LUT - 5 Input lookup table</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvdsin_doc.html">LVDSIN - LVDS Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvdsout_doc.html">LVDSOUT - LVDS Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="outenc_doc.html">OUTENC - Output encoder</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">PCAP - Position Capture</a></li>
<li class="toctree-l4"><a class="reference internal" href="pcomp_doc.html">PCOMP - Position Compare</a></li>
<li class="toctree-l4"><a class="reference internal" href="pgen_doc.html">PGEN - Position Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pmacenc_doc.html">PMACENC - Pmac encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="posenc_doc.html">POSENC - Quadrature and step/direction encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulse_doc.html">PULSE - One-shot pulse delay and stretch</a></li>
<li class="toctree-l4"><a class="reference internal" href="qdec_doc.html">QDEC - Quadrature Decoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="seq_doc.html">SEQ - Sequencer</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_dls_eventr_doc.html">SFP_DLS_EVENTR - SFP Event Receiver Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_loopback_doc.html">SFP_LOOPBACK- SFP Loopback Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_panda_sync_doc.html">SFP_PANDA_SYNC - Synchronize data between 2 PandAs</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_udpontrig_doc.html">SFP_UDPONTRIG - SFP UDP on trig Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="srgate_doc.html">SRGATE - Set Reset Gate</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_doc.html">SYSTEM - System control FPGA</a></li>
<li class="toctree-l4"><a class="reference internal" href="ttlin_doc.html">TTLIN - TTL Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="ttlout_doc.html">TTLOUT - TTL Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html">Assembling Blocks into an App</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/block.html">Writing a Block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/framework.html">Autogeneration framework architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/testing.html">Running the tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial1_blinking_leds.html">Blinking LEDs Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial2_position_capture.html">Position Capture Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial3_position_compare.html">Position Compare Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial4_snake_scan.html">Snake Scan Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../blocks.html">Available Blocks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="absenc_doc.html">ABSENC - Absolute encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="bits_doc.html">BITS - Soft inputs and constant bits</a></li>
<li class="toctree-l2"><a class="reference internal" href="calc_doc.html">CALC - Position Calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="clock_doc.html">CLOCK - Configurable clock</a></li>
<li class="toctree-l2"><a class="reference internal" href="counter_doc.html">COUNTER - Up/Down pulse counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="div_doc.html">DIV - Pulse divider</a></li>
<li class="toctree-l2"><a class="reference internal" href="equ_doc.html">EQU - EQU Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter_doc.html">FILTER - Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_24v_doc.html">FMC_24V - FMC 24V IO Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_acq427_doc.html">FMC_ACQ427 - FMC ACQ427 Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_acq430_doc.html">FMC_ACQ430 - FMC ACQ430 Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_loopback_doc.html">FMC_LOOPBACK - FMC Loopback Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="incenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="inenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="lut_doc.html">LUT - 5 Input lookup table</a></li>
<li class="toctree-l2"><a class="reference internal" href="lvdsin_doc.html">LVDSIN - LVDS Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="lvdsout_doc.html">LVDSOUT - LVDS Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="outenc_doc.html">OUTENC - Output encoder</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PCAP - Position Capture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arming">Arming</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capturing-fields">Capturing fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pos-bus-capture">Pos bus capture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mode-0-value">Mode 0 - Value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-1-difference">Mode 1 - Difference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-2-3-sum-lo-hi">Mode 2/3 - Sum Lo/Hi</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-4-5-min-max">Mode 4/5 - Min/Max</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-6-7-8-sum-of-squared-values-lo-mid-hi">Mode 6/7/8 - Sum of Squared values Lo/Mid/Hi</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#number-of-samples">Number of samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bit-bus-capture">Bit bus capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#triggering-options">Triggering options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-conditions">Error conditions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pcomp_doc.html">PCOMP - Position Compare</a></li>
<li class="toctree-l2"><a class="reference internal" href="pgen_doc.html">PGEN - Position Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="pmacenc_doc.html">PMACENC - Pmac encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="posenc_doc.html">POSENC - Quadrature and step/direction encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="pulse_doc.html">PULSE - One-shot pulse delay and stretch</a></li>
<li class="toctree-l2"><a class="reference internal" href="qdec_doc.html">QDEC - Quadrature Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="seq_doc.html">SEQ - Sequencer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_dls_eventr_doc.html">SFP_DLS_EVENTR - SFP Event Receiver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_loopback_doc.html">SFP_LOOPBACK- SFP Loopback Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_panda_sync_doc.html">SFP_PANDA_SYNC - Synchronize data between 2 PandAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_udpontrig_doc.html">SFP_UDPONTRIG - SFP UDP on trig Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="srgate_doc.html">SRGATE - Set Reset Gate</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_doc.html">SYSTEM - System control FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="ttlin_doc.html">TTLIN - TTL Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="ttlout_doc.html">TTLOUT - TTL Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/app.html">Assembling Blocks into an App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/block.html">Writing a Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/framework.html">Autogeneration framework architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/testing.html">Running the tests</a></li>
</ul>

  <!-- Include link to changelog -->
  <a href="https://github.com/PandABlocks/PandABlocks-FPGA/blob/master/CHANGELOG.rst">Changelog</a>
  <!-- Add versions for selected branches + tags -->
  <p class="caption"><span class="caption-text">Versions</span></p>
  <ul id="versions"/>
  <script>
    // Add any branches to appear in the side pane here, tags will be added below
    // Will only appear if docs are built and pushed in gh-pages
    var versions = ['master', 'main'];
    var dirs = new Set();
    function addVersion(name) {
      if (dirs.has(name)) {
        var li = document.createElement("li");
        var a = document.createElement("a");
        a.href = 'https://PandABlocks.github.io/PandABlocks-FPGA/' + name;
        a.innerText = name;
        li.appendChild(a)
        document.getElementById('versions').appendChild(li);
      }
    }
    Promise.all([
      // Find gh-pages directories and populate `dirs`
      fetch("https://api.github.com/repos/PandABlocks/PandABlocks-FPGA/contents?ref=gh-pages")
      .then(response => response.json())
      .then(data => data.forEach(function(e) {
        if (e.type == "dir") dirs.add(e.name);
      })),
      // Add tags to `versions`
      fetch('https://api.github.com/repos/PandABlocks/PandABlocks-FPGA/tags')
        .then(response => response.json())
        .then(data => data.forEach(function(e) {
          versions.push(e.name);
        }))
      ]).then(_ => versions.forEach(addVersion))
  </script>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PandABlocks-FPGA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../blocks.html">Available Blocks</a></li>
      <li class="breadcrumb-item active">PCAP - Position Capture</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/build/pcap_doc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="pcap-position-capture">
<h1>PCAP - Position Capture<a class="headerlink" href="#pcap-position-capture" title="Permalink to this heading"></a></h1>
<p>Position capture has the capability to capture anything that is happening
on the pos_bus or bit_bus. It listens to ENABLE, GATE and CAPTURE signals, and
can capture the value at capture, sum, sum of squared values, min and max.</p>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ENABLE</p></td>
<td><p>bit_mux</p></td>
<td><p>After arm, when high start capture, when low disarm</p></td>
</tr>
<tr class="row-odd"><td><p>GATE</p></td>
<td><p>bit_mux</p></td>
<td><p>After enable, only process gated values if high</p></td>
</tr>
<tr class="row-even"><td><p>TRIG</p></td>
<td><p>bit_mux</p></td>
<td><p>On selected edge capture current value and gated data</p></td>
</tr>
<tr class="row-odd"><td><p>TRIG_EDGE</p></td>
<td><p>param enum</p></td>
<td><p><div class="line-block">
<div class="line">Which edge of capture input signal triggers capture</div>
<div class="line">0   Rising</div>
<div class="line">1   Falling</div>
<div class="line">2   Either</div>
</div>
</p></td>
</tr>
<tr class="row-even"><td><p>SHIFT_SUM</p></td>
<td><p>param uint 8</p></td>
<td><p>Shift sum/samples data, use if &gt; 2**32 samples required in sum/average</p></td>
</tr>
<tr class="row-odd"><td><p>ACTIVE</p></td>
<td><p>bit_out</p></td>
<td><p>Data capture in progress</p></td>
</tr>
<tr class="row-even"><td><p>TS_START</p></td>
<td><p>ext_out timestamp</p></td>
<td><p>Timestamp of first gate high in current capture relative to enable</p></td>
</tr>
<tr class="row-odd"><td><p>TS_END</p></td>
<td><p>ext_out timestamp</p></td>
<td><p>Timestamp of last gate high +1 in current capture relative to enable</p></td>
</tr>
<tr class="row-even"><td><p>TS_TRIG</p></td>
<td><p>ext_out timestamp</p></td>
<td><p>Timestamp of capture event relative to enable</p></td>
</tr>
<tr class="row-odd"><td><p>GATE_DURATION</p></td>
<td><p>ext_out samples</p></td>
<td><p>Number of gated samples in the current capture</p></td>
</tr>
<tr class="row-even"><td><p>BITS0</p></td>
<td><p>ext_out bits 0</p></td>
<td><p>Quadrant 0 of bit_bus</p></td>
</tr>
<tr class="row-odd"><td><p>BITS1</p></td>
<td><p>ext_out bits 1</p></td>
<td><p>Quadrant 1 of bit_bus</p></td>
</tr>
<tr class="row-even"><td><p>BITS2</p></td>
<td><p>ext_out bits 2</p></td>
<td><p>Quadrant 2 of bit_bus</p></td>
</tr>
<tr class="row-odd"><td><p>BITS3</p></td>
<td><p>ext_out bits 3</p></td>
<td><p>Quadrant 3 of bit_bus</p></td>
</tr>
<tr class="row-even"><td><p>HEALTH</p></td>
<td><p>read enum</p></td>
<td><p><div class="line-block">
<div class="line">Was last capture successful?</div>
<div class="line">0   OK</div>
<div class="line">1   Capture events too close together</div>
<div class="line">2   Samples overflow</div>
</div>
</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="arming">
<h2>Arming<a class="headerlink" href="#arming" title="Permalink to this heading"></a></h2>
<p>To start off the block an arm signal is required with a write to <code class="docutils literal notranslate"><span class="pre">*PCAP.ARM=</span></code>.
The active signal is raised immediately on ARM, and dropped either on
<code class="docutils literal notranslate"><span class="pre">*PCAP.DISARM</span></code>:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/02a2d89407759617506e68274aa20382/pcap_doc-1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/36b1f23b5aa288fbace87ea91744d9e1/pcap_doc-1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/e505abf2c52f27c0092ae4916ac4a895/pcap_doc-1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d8f96a21a7eae7190e7484fb41d5e13b/pcap_doc-1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-1.png" class="plot-directive" src="../_images/pcap_doc-1.png" />
</div>
<p>Or on the falling edge of ENABLE:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/20ac5d0556047240a1e454bb3e84a4ec/pcap_doc-2.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/eea0df29e148b09c9180b06bdf8c8f54/pcap_doc-2.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/841131adb05ce673fdcda3dfac42f76f/pcap_doc-2.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/ea798ff35c74cacf1a71033367907eae/pcap_doc-2.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-2.png" class="plot-directive" src="../_images/pcap_doc-2.png" />
</div>
</div>
<div class="section" id="capturing-fields">
<h2>Capturing fields<a class="headerlink" href="#capturing-fields" title="Permalink to this heading"></a></h2>
<p>Capturing fields is done by specifying a series of WRITE addresses. These are
made up of a mode in the bottom 4 bits, and an index in the 6 bits above them.
Indexes &lt; 32 refer to entries on the pos_bus, while indexes &gt;= 32 are extra
entries specific to PCAP, like timestamps and number of gated samples. The
values sent via the WRITE register are written from the TCP server, so will
not be visible to end users.</p>
<p>Data is ticked out one at a time from the DATA attribute, then sent to the TCP
server over DMA, before being sent to the user. It is reconstructed into a
table in each of the examples below for ease of reading.</p>
<p>The following example shows PCAP being configured to capture the timestamp
when CAPTURE goes high (0x24 is the bottom 32-bits of TS_CAPTURE).</p>
<p>(<a class="reference download internal" download="" href="../_downloads/4e6c5fb9f37a9a8a7dd13066680b7c36/pcap_doc-3.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/00de385cb15079a10088efc2a302bb6b/pcap_doc-3.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/1d0c2f548097668070749152b34b5147/pcap_doc-3.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/733f244568d134b8b122e5329b3a9480/pcap_doc-3.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-3.png" class="plot-directive" src="../_images/pcap_doc-3.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x240</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pos-bus-capture">
<h2>Pos bus capture<a class="headerlink" href="#pos-bus-capture" title="Permalink to this heading"></a></h2>
<p>As well as general fields like the timestamp, any pos_bus index can be captured.
Pos bus fields have multiple modes that they can capture in.</p>
<div class="section" id="mode-0-value">
<h3>Mode 0 - Value<a class="headerlink" href="#mode-0-value" title="Permalink to this heading"></a></h3>
<p>This gives an instantaneous capture of value no matter what the state of GATE:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/40d1c30ec91a38b50c1c4a971aa22be9/pcap_doc-4.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/4ea7c227099a3347a0366a05f1018363/pcap_doc-4.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/8fd6a0bf89d7d8c4cf3bf63730550c23/pcap_doc-4.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/73ef3071cbb6f8ae0ebddfca5a8f56ef/pcap_doc-4.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-4.png" class="plot-directive" src="../_images/pcap_doc-4.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x50</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>6</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-1-difference">
<h3>Mode 1 - Difference<a class="headerlink" href="#mode-1-difference" title="Permalink to this heading"></a></h3>
<p>This is mainly used for something like an incrementing counter value.
It will only count the differences while GATE was high:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/8e11b700e88a127db057c230d22ca654/pcap_doc-5.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/6ddbf4c79933e7c91db607fdee399cc4/pcap_doc-5.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/64a23715873d28d1e4b0ab7d5dcbde22/pcap_doc-5.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/ba40e4f4b7f31c1c86cc7392fd7a9616/pcap_doc-5.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-5.png" class="plot-directive" src="../_images/pcap_doc-5.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0xB1</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>-5</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-2-3-sum-lo-hi">
<h3>Mode 2/3 - Sum Lo/Hi<a class="headerlink" href="#mode-2-3-sum-lo-hi" title="Permalink to this heading"></a></h3>
<p>Mode 2 is the lower 32-bits of the sum of all samples while GATE was high:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/bc241083da075aaa5361df76cf7175ca/pcap_doc-6.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/55339fc5b2be2227390ae06cdbcf19e3/pcap_doc-6.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/1aef458085efc44b22c5a163738897e4/pcap_doc-6.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/fcef6063ec82b6f28e9457a59e7b79dc/pcap_doc-6.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-6.png" class="plot-directive" src="../_images/pcap_doc-6.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x32</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>206</p></td>
</tr>
</tbody>
</table>
<p>Mode 2 and 3 together gives the full 64-bits of sum, needed for any sizeable
values on the pos_bus:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/367d76e340151c814914ab8b90bf1523/pcap_doc-7.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/4a8fa5b8d0276889af117841e61444c5/pcap_doc-7.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d6e9f856699c9216529153e5765afce9/pcap_doc-7.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/e216d597c53b93748c7efe8faf039c17/pcap_doc-7.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-7.png" class="plot-directive" src="../_images/pcap_doc-7.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 36%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x22</p></th>
<th class="head"><p>0x23</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1073741824</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>-1073741824</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>-2147483648</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>-1073741824</p></td>
<td><p>-1</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>-1073741824</p></td>
<td><p>-2</p></td>
</tr>
</tbody>
</table>
<p>If long frame times (&gt; 2**32 SAMPLES, &gt; 30s), are to be used, then SHIFT_SUM
can be used to shift both the sum and SAMPLES field by up to 8-bits to
accomodate up to 125 hour frames. This example demonstrates the effect with
smaller numbers:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/19c2f7bff72c89856652f5a586905504/pcap_doc-8.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/02425b9c8418b40e06727babdb902f3f/pcap_doc-8.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d060ff19b5f11a08ab95632c46249052/pcap_doc-8.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/9706beda40ebc401656dafd13c8c1169/pcap_doc-8.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-8.png" class="plot-directive" src="../_images/pcap_doc-8.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 33%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x92</p></th>
<th class="head"><p>0x260</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>40</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>36</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>-13</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-4-5-min-max">
<h3>Mode 4/5 - Min/Max<a class="headerlink" href="#mode-4-5-min-max" title="Permalink to this heading"></a></h3>
<p>Both of these modes calculate statistics on the value while GATE is high.</p>
<p>Mode 4 produces the min of all values or zero if the gate was low for all of the
current capture:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/e666192ea72b18bbdc15ef12fe56c05b/pcap_doc-9.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/317e03d006861cbface2514e5eb38505/pcap_doc-9.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/cbabe879c548f0f116e325c0373c3b10/pcap_doc-9.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/cf43ed7d63c83473a95d3b1fd7656eb3/pcap_doc-9.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-9.png" class="plot-directive" src="../_images/pcap_doc-9.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x84</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>21</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>2147483647</p></td>
</tr>
</tbody>
</table>
<p>Mode 5 produces the max of all values in a similar way:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/95c99844a6b899de1adb2a7ad548e152/pcap_doc-10.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/1737569a62f63af849479d5dd35a4b35/pcap_doc-10.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d751ec5c969c3c6901b8ff74350b6d02/pcap_doc-10.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/e20adb8e9d8990cef101ba7f91f7330e/pcap_doc-10.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-10.png" class="plot-directive" src="../_images/pcap_doc-10.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x45</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>-2147483648</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-6-7-8-sum-of-squared-values-lo-mid-hi">
<h3>Mode 6/7/8 - Sum of Squared values Lo/Mid/Hi<a class="headerlink" href="#mode-6-7-8-sum-of-squared-values-lo-mid-hi" title="Permalink to this heading"></a></h3>
<p>Mode 6/7/8 is only implemented when target supports pcap_std_dev fpga option.</p>
<p>Mode 6, 7 and 8 together gives the full 96-bits of sum of squared values
needed for any sizeable values on the pos_bus.</p>
<p>Mode 6 is the lower 32-bits while GATE was high, Mode 7 is the middle 32-bits,
and Mode 8 is the higher 32-bits:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/7d06afaf70278ec66fd69997b78bbf01/pcap_doc-11.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/2342fca084930c3bd9fe3cfc3b5f53bd/pcap_doc-11.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/4d7f86a3b7930419e0e599015a3f5afe/pcap_doc-11.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/b24b567e5cae706417fe78fb9fe23471/pcap_doc-11.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-111.png" class="plot-directive" src="../_images/pcap_doc-111.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x26</p></th>
<th class="head"><p>0x27</p></th>
<th class="head"><p>0x28</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>18</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>176</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>8</p></td>
<td><p>4294967288</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>If long frame times (&gt; 2**32 SAMPLES, &gt; 30s), are to be used, then SHIFT_SUM
can be used to shift both the sum of squared values and SAMPLES field
by up to 8-bits to accomodate up to 125 hour frames:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/d524ea4774fba7c26cd20fb1a9b18ed4/pcap_doc-12.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/9c128287f477a9fb375810ea690d0870/pcap_doc-12.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/14cfca4d245f0bf2a97f175544b0bace/pcap_doc-12.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/cadf37d27439470ccdaad30ad1b8747f/pcap_doc-12.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-12.png" class="plot-directive" src="../_images/pcap_doc-12.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x26</p></th>
<th class="head"><p>0x27</p></th>
<th class="head"><p>0x28</p></th>
<th class="head"><p>0x260</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>9</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>88</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>4</p></td>
<td><p>4294967292</p></td>
<td><p>0</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="number-of-samples">
<h2>Number of samples<a class="headerlink" href="#number-of-samples" title="Permalink to this heading"></a></h2>
<p>There is a SAMPLES field that can be captured that will give the number of clock
ticks that GATE was high during a single CAPTURE. This field allows the TCP
server to offer “Mean” as a capture option, dividing “Sum” by SAMPLES to get
the mean value of the field during the capture period. It can also be captured
separately to give the gate length:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/07cc0babf29be77900b097e8ebea56d2/pcap_doc-13.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/e34f4de2fb7d0abc6cc70c4111347ee3/pcap_doc-13.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/2bf1b3460012989e2203bd6b8321663d/pcap_doc-13.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d8bb352ece0ba8ea4f05c06a9359b13e/pcap_doc-13.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-13.png" class="plot-directive" src="../_images/pcap_doc-13.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x260</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="timestamps">
<h2>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this heading"></a></h2>
<p>As well as the timestamp of the capture signal, timestamps can also be generated
for the start of each capture period (first gate high signal) and end (the tick
after the last gate high). These are again split into two 32-bit segments so
only the lower bits need to be captured for short captures. In the following
example we capture TS_START (0x20), TS_END (0x22) and TS_CAPTURE (0x24) lower
bits:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/2dbb3161e7386320c6c90eb62d44ff2a/pcap_doc-14.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/c81e027c3c4474b576927ea0bf4de8b0/pcap_doc-14.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/31cbd8614b3a7d79c575eb24548b61e3/pcap_doc-14.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/c0dccdf2baf867a6b9b16746b524fdec/pcap_doc-14.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-14.png" class="plot-directive" src="../_images/pcap_doc-14.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x200</p></th>
<th class="head"><p>0x220</p></th>
<th class="head"><p>0x240</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>4</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>4</p></td>
<td><p>8</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>11</p></td>
<td><p>13</p></td>
<td><p>13</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>-1</p></td>
<td><p>-1</p></td>
<td><p>16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bit-bus-capture">
<h2>Bit bus capture<a class="headerlink" href="#bit-bus-capture" title="Permalink to this heading"></a></h2>
<p>The state of the bit bus at capture can also be captured. It is split into 4
quadrants of 32-bits each. For example, to capture signals 0..31 on the bit bus
we would use BITS0 (0x27):</p>
<p>(<a class="reference download internal" download="" href="../_downloads/31245d9ec12304ed0b02e0b6986216ba/pcap_doc-15.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/98b9ad0241631edca72e06e34f8170cc/pcap_doc-15.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/898429742949c100c22ac5ae854ded6d/pcap_doc-15.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/6ba26834799497ec9da6765f26eb2892/pcap_doc-15.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-15.png" class="plot-directive" src="../_images/pcap_doc-15.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x270</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>16</p></td>
</tr>
</tbody>
</table>
<p>By capturing all 4 quadrants (0x27..0x2A) we get the whole bit bus:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/7f183b0ef4fb1831052d6ed0079acb90/pcap_doc-16.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/11ae9c7a628ef766cea228f7bf279d82/pcap_doc-16.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/13a7cec33fc68f82ba235b0e9a14ca23/pcap_doc-16.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/51b1f8b6c4a2bf5900fbaa72e200b07b/pcap_doc-16.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-16.png" class="plot-directive" src="../_images/pcap_doc-16.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x270</p></th>
<th class="head"><p>0x280</p></th>
<th class="head"><p>0x290</p></th>
<th class="head"><p>0x2A0</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>4</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>4</p></td>
<td><p>67108864</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>4</p></td>
<td><p>67108864</p></td>
<td><p>0</p></td>
<td><p>32</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>1028</p></td>
<td><p>67108864</p></td>
<td><p>0</p></td>
<td><p>32</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="triggering-options">
<h2>Triggering options<a class="headerlink" href="#triggering-options" title="Permalink to this heading"></a></h2>
<p>ENABLE and GATE are level triggered, with ENABLE used for marking the start and
end of the entire acquisition, and GATE used to accept or reject samples within
a single capture from the acquisition. CAPTURE is edge triggered with an option
to trigger on rising, falling or both edges.</p>
<p>Triggering on rising is the default, explored in the preceding examples.
Triggering on falling edge would be used if you have a gate signal that
marks the capture boundaries and want sum or difference data within. For
example, to capture the amount POS[1] changes in each capture gate we could
connect GATE and CAPTURE to the same signal:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/ac0d10e755367ce03da09d3737494f31/pcap_doc-17.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/1314f1985df0c61af2fe385d25ceb7a1/pcap_doc-17.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/6b567e7e7e6afa344e58db4c96ee3698/pcap_doc-17.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/e5e339310a871abc762332e42ce29877/pcap_doc-17.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-17.png" class="plot-directive" src="../_images/pcap_doc-17.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x11</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>-9</p></td>
</tr>
</tbody>
</table>
<p>Another option would be a gap-less acquisition of sum while gate is high
with capture boundaries marked with a toggle of CAPTURE:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/86cd33ddd3e58cbaebe963379d2dd2c6/pcap_doc-18.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/d0cfed76baf0f882ed42a90edc63b087/pcap_doc-18.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/73d94f2152954bfd904dd766f63399e8/pcap_doc-18.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/83c80de467767ecb5935be8d7da9b8a8/pcap_doc-18.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-18.png" class="plot-directive" src="../_images/pcap_doc-18.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x12</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>178</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>39</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="error-conditions">
<h2>Error conditions<a class="headerlink" href="#error-conditions" title="Permalink to this heading"></a></h2>
<p>The distance between capture signals must be at least the number of 32-bit
capture fields. If 2 capture signals are too close together HEALTH will be
set to 1 (Capture events too close together).</p>
<p>In this example there are 3 fields captured (TS_CAPTURE_L, TS_CAPTURE_H,
SAMPLES), but only 2 clock ticks between the 2nd and 3rd capture signals:</p>
<p>(<a class="reference download internal" download="" href="../_downloads/a77726613a9718807c3ef15184f0aa9b/pcap_doc-19.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../_downloads/0d09974d3d854914b81584673cb26a4e/pcap_doc-19.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/dd2b8f862e0c3910e6339cf9404c5ad8/pcap_doc-19.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../_downloads/2878504bc2fb795bf8aafc0a92a4faa3/pcap_doc-19.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<div class="figure align-default">
<img alt="../_images/pcap_doc-19.png" class="plot-directive" src="../_images/pcap_doc-19.png" />
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 28%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Row</p></th>
<th class="head"><p>0x240</p></th>
<th class="head"><p>0x250</p></th>
<th class="head"><p>0x260</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>5</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="outenc_doc.html" class="btn btn-neutral float-left" title="OUTENC - Output encoder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pcomp_doc.html" class="btn btn-neutral float-right" title="PCOMP - Position Compare" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, Diamond Light Source.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>