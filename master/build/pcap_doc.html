

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PCAP - Position Capture &mdash; PandABlocks-FPGA 3.0a2-3-gc29323f
 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/PandA-logo.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PCOMP - Position Compare" href="pcomp_doc.html" />
    <link rel="prev" title="OUTENC - Output encoder" href="outenc_doc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="../index.html" class="icon icon-home"> PandABlocks-FPGA
          

          
            
            <img src="../_static/PandA-logo-for-black-background.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.0a2-3-gc29323f

              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  <style>
    /* style mobile top nav to look like main nav */
    .wy-nav-top {
        background: black
    }
  </style>
  
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">What can PandABlocks do?</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html#how-is-the-documentation-structured">How is the documentation structured?</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#using-an-existing-pandablocks-device">Using an existing PandABlocks device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#generating-a-new-set-of-blocks-for-a-pandablocks-device">Generating a new set of Blocks for a PandABlocks device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#extending-the-functionality-of-a-pandablocks-device">Extending the functionality of a PandABlocks device</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#working-on-the-core-autogeneration-framework">Working on the core autogeneration framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial1_blinking_leds.html">Blinking LEDs Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial2_position_capture.html">Position Capture Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial3_position_compare.html">Position Compare Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/tutorial4_snake_scan.html">Snake Scan Tutorial</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../blocks.html">Available Blocks</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="bits_doc.html">BITS - Soft inputs and constant bits</a></li>
<li class="toctree-l4"><a class="reference internal" href="calc_doc.html">CALC - Position Calc</a></li>
<li class="toctree-l4"><a class="reference internal" href="clock_doc.html">CLOCK - Configurable clock</a></li>
<li class="toctree-l4"><a class="reference internal" href="counter_doc.html">COUNTER - Up/Down pulse counter</a></li>
<li class="toctree-l4"><a class="reference internal" href="div_doc.html">DIV - Pulse divider</a></li>
<li class="toctree-l4"><a class="reference internal" href="filter_doc.html">FILTER - Filter</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_24v_doc.html">FMC_24V - FMC 24V IO Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_acq427_doc.html">FMC_ACQ427 - FMC ACQ427 Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_acq430_doc.html">FMC_ACQ430 - FMC ACQ430 Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="fmc_loopback_doc.html">FMC_LOOPBACK - FMC Loopback Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="inenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="lut_doc.html">LUT - 5 Input lookup table</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvdsin_doc.html">LVDSIN - LVDS Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="lvdsout_doc.html">LVDSOUT - LVDS Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="outenc_doc.html">OUTENC - Output encoder</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">PCAP - Position Capture</a></li>
<li class="toctree-l4"><a class="reference internal" href="pcomp_doc.html">PCOMP - Position Compare</a></li>
<li class="toctree-l4"><a class="reference internal" href="pgen_doc.html">PGEN - Position Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="posenc_doc.html">POSENC - Quadrature and step/direction encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="pulse_doc.html">PULSE - One-shot pulse delay and stretch</a></li>
<li class="toctree-l4"><a class="reference internal" href="qdec_doc.html">QDEC - Quadrature Decoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="seq_doc.html">SEQ - Sequencer</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_dls_eventr_doc.html">SFP_DLS_EVENTR - SFP Event Receiver Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_loopback_doc.html">SFP_LOOPBACK- SFP Loopback Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_panda_sync_doc.html">SFP_PANDA_SYNC - Synchronize data between 2 PandAs</a></li>
<li class="toctree-l4"><a class="reference internal" href="sfp_udpontrig_doc.html">SFP_UDPONTRIG - SFP UDP on trig Module</a></li>
<li class="toctree-l4"><a class="reference internal" href="srgate_doc.html">SRGATE - Set Reset Gate</a></li>
<li class="toctree-l4"><a class="reference internal" href="system_doc.html">SYSTEM - System control FPGA</a></li>
<li class="toctree-l4"><a class="reference internal" href="ttlin_doc.html">TTLIN - TTL Input</a></li>
<li class="toctree-l4"><a class="reference internal" href="ttlout_doc.html">TTLOUT - TTL Output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html">Assembling Blocks into an App</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/block.html">Writing a Block</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/framework.html">Autogeneration framework architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/testing.html">Running the tests</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial1_blinking_leds.html">Blinking LEDs Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial2_position_capture.html">Position Capture Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial3_position_compare.html">Position Compare Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial4_snake_scan.html">Snake Scan Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../blocks.html">Available Blocks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bits_doc.html">BITS - Soft inputs and constant bits</a></li>
<li class="toctree-l2"><a class="reference internal" href="calc_doc.html">CALC - Position Calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="clock_doc.html">CLOCK - Configurable clock</a></li>
<li class="toctree-l2"><a class="reference internal" href="counter_doc.html">COUNTER - Up/Down pulse counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="div_doc.html">DIV - Pulse divider</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter_doc.html">FILTER - Filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_24v_doc.html">FMC_24V - FMC 24V IO Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_acq427_doc.html">FMC_ACQ427 - FMC ACQ427 Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_acq430_doc.html">FMC_ACQ430 - FMC ACQ430 Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="fmc_loopback_doc.html">FMC_LOOPBACK - FMC Loopback Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="inenc_doc.html">INENC - Input encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="lut_doc.html">LUT - 5 Input lookup table</a></li>
<li class="toctree-l2"><a class="reference internal" href="lvdsin_doc.html">LVDSIN - LVDS Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="lvdsout_doc.html">LVDSOUT - LVDS Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="outenc_doc.html">OUTENC - Output encoder</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PCAP - Position Capture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fields">Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arming">Arming</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capturing-fields">Capturing fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pos-bus-capture">Pos bus capture</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mode-0-value">Mode 0 - Value</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-1-difference">Mode 1 - Difference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-2-3-sum-lo-hi">Mode 2/3 - Sum Lo/Hi</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mode-4-5-min-max">Mode 4/5 - Min/Max</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#number-of-samples">Number of samples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bit-bus-capture">Bit bus capture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#triggering-options">Triggering options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-conditions">Error conditions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pcomp_doc.html">PCOMP - Position Compare</a></li>
<li class="toctree-l2"><a class="reference internal" href="pgen_doc.html">PGEN - Position Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="posenc_doc.html">POSENC - Quadrature and step/direction encoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="pulse_doc.html">PULSE - One-shot pulse delay and stretch</a></li>
<li class="toctree-l2"><a class="reference internal" href="qdec_doc.html">QDEC - Quadrature Decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="seq_doc.html">SEQ - Sequencer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_dls_eventr_doc.html">SFP_DLS_EVENTR - SFP Event Receiver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_loopback_doc.html">SFP_LOOPBACK- SFP Loopback Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_panda_sync_doc.html">SFP_PANDA_SYNC - Synchronize data between 2 PandAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp_udpontrig_doc.html">SFP_UDPONTRIG - SFP UDP on trig Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="srgate_doc.html">SRGATE - Set Reset Gate</a></li>
<li class="toctree-l2"><a class="reference internal" href="system_doc.html">SYSTEM - System control FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="ttlin_doc.html">TTLIN - TTL Input</a></li>
<li class="toctree-l2"><a class="reference internal" href="ttlout_doc.html">TTLOUT - TTL Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/app.html">Assembling Blocks into an App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/block.html">Writing a Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/framework.html">Autogeneration framework architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/testing.html">Running the tests</a></li>
</ul>

            
          
  <!-- Include link to changelog -->
  <a href="https://github.com/PandABlocks/PandABlocks-FPGA/blob/master/CHANGELOG.rst">Changelog</a>
  <!-- Add versions for selected branches + tags -->
  <p class="caption"><span class="caption-text">Versions</span></p>
  <ul id="versions"/>
  <script>
    // Add any branches to appear in the side pane here, tags will be added below
    // Will only appear if docs are built and pushed in gh-pages
    var versions = ['master', 'main'];
    var dirs = new Set();
    function addVersion(name) {
      if (dirs.has(name)) {
        var li = document.createElement("li");
        var a = document.createElement("a");
        a.href = 'https://PandABlocks.github.io/PandABlocks-FPGA/' + name;
        a.innerText = name;
        li.appendChild(a)
        document.getElementById('versions').appendChild(li);
      }
    }
    Promise.all([
      // Find gh-pages directories and populate `dirs`
      fetch("https://api.github.com/repos/PandABlocks/PandABlocks-FPGA/contents?ref=gh-pages")
      .then(response => response.json())
      .then(data => data.forEach(function(e) {
        if (e.type == "dir") dirs.add(e.name);
      })),
      // Add tags to `versions`
      fetch('https://api.github.com/repos/PandABlocks/PandABlocks-FPGA/tags')
        .then(response => response.json())
        .then(data => data.forEach(function(e) {
          versions.push(e.name);
        }))
      ]).then(_ => versions.forEach(addVersion))
  </script>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PandABlocks-FPGA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../blocks.html">Available Blocks</a> &raquo;</li>
        
      <li>PCAP - Position Capture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/build/pcap_doc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pcap-position-capture">
<h1>PCAP - Position Capture<a class="headerlink" href="#pcap-position-capture" title="Permalink to this headline">¶</a></h1>
<p>Position capture has the capability to capture anything that is happening
on the pos_bus or bit_bus. It listens to ENABLE, GATE and CAPTURE signals, and
can capture the value at capture, sum, min and max.</p>
<div class="section" id="fields">
<h2>Fields<a class="headerlink" href="#fields" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ENABLE</td>
<td>bit_mux</td>
<td>After arm, when high start capture, when low disarm</td>
</tr>
<tr class="row-odd"><td>GATE</td>
<td>bit_mux</td>
<td>After enable, only process gated values if high</td>
</tr>
<tr class="row-even"><td>TRIG</td>
<td>bit_mux</td>
<td>On selected edge capture current value and gated data</td>
</tr>
<tr class="row-odd"><td>TRIG_EDGE</td>
<td>param enum</td>
<td><div class="line-block">
<div class="line">Which edge of capture input signal triggers capture</div>
<div class="line">0   Rising</div>
<div class="line">1   Falling</div>
<div class="line">2   Either</div>
</div>
</td>
</tr>
<tr class="row-even"><td>SHIFT_SUM</td>
<td>param uint 8</td>
<td>Shift sum/samples data, use if &gt; 2**32 samples required in sum/average</td>
</tr>
<tr class="row-odd"><td>ACTIVE</td>
<td>bit_out</td>
<td>Data capture in progress</td>
</tr>
<tr class="row-even"><td>TS_START</td>
<td>ext_out timestamp</td>
<td>Timestamp of first gate high in current capture relative to enable</td>
</tr>
<tr class="row-odd"><td>TS_END</td>
<td>ext_out timestamp</td>
<td>Timestamp of last gate high +1 in current capture relative to enable</td>
</tr>
<tr class="row-even"><td>TS_TRIG</td>
<td>ext_out timestamp</td>
<td>Timestamp of capture event relative to enable</td>
</tr>
<tr class="row-odd"><td>SAMPLES</td>
<td>ext_out samples</td>
<td>Number of gated samples in the current capture</td>
</tr>
<tr class="row-even"><td>BITS0</td>
<td>ext_out bits 0</td>
<td>Quadrant 0 of bit_bus</td>
</tr>
<tr class="row-odd"><td>BITS1</td>
<td>ext_out bits 1</td>
<td>Quadrant 1 of bit_bus</td>
</tr>
<tr class="row-even"><td>BITS2</td>
<td>ext_out bits 2</td>
<td>Quadrant 2 of bit_bus</td>
</tr>
<tr class="row-odd"><td>BITS3</td>
<td>ext_out bits 3</td>
<td>Quadrant 3 of bit_bus</td>
</tr>
<tr class="row-even"><td>HEALTH</td>
<td>read enum</td>
<td><div class="line-block">
<div class="line">Was last capture successful?</div>
<div class="line">0   OK</div>
<div class="line">1   Capture events too close together</div>
<div class="line">2   Samples overflow</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="arming">
<h2>Arming<a class="headerlink" href="#arming" title="Permalink to this headline">¶</a></h2>
<p>To start off the block an arm signal is required with a write to <code class="docutils literal notranslate"><span class="pre">*PCAP.ARM=</span></code>.
The active signal is raised immediately on ARM, and dropped either on
<code class="docutils literal notranslate"><span class="pre">*PCAP.DISARM</span></code>:</p>
<p>(<a class="reference external" href="../build/pcap_doc-1.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-1.png">png</a>, <a class="reference external" href="../build/pcap_doc-1.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-1.png" class="plot-directive" src="../_images/pcap_doc-1.png" />
</div>
<p>Or on the falling edge of ENABLE:</p>
<p>(<a class="reference external" href="../build/pcap_doc-2.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-2.png">png</a>, <a class="reference external" href="../build/pcap_doc-2.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-2.png" class="plot-directive" src="../_images/pcap_doc-2.png" />
</div>
</div>
<div class="section" id="capturing-fields">
<h2>Capturing fields<a class="headerlink" href="#capturing-fields" title="Permalink to this headline">¶</a></h2>
<p>Capturing fields is done by specifying a series of WRITE addresses. These are
made up of a mode in the bottom 4 bits, and an index in the 6 bits above them.
Indexes &lt; 32 refer to entries on the pos_bus, while indexes &gt;= 32 are extra
entries specific to PCAP, like timestamps and number of gated samples. The
values sent via the WRITE register are written from the TCP server, so will
not be visible to end users.</p>
<p>Data is ticked out one at a time from the DATA attribute, then sent to the TCP
server over DMA, before being sent to the user. It is reconstructed into a
table in each of the examples below for ease of reading.</p>
<p>The following example shows PCAP being configured to capture the timestamp
when CAPTURE goes high (0x24 is the bottom 32-bits of TS_CAPTURE).</p>
<p>(<a class="reference external" href="../build/pcap_doc-3.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-3.png">png</a>, <a class="reference external" href="../build/pcap_doc-3.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-3.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-3.png" class="plot-directive" src="../_images/pcap_doc-3.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x240</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pos-bus-capture">
<h2>Pos bus capture<a class="headerlink" href="#pos-bus-capture" title="Permalink to this headline">¶</a></h2>
<p>As well as general fields like the timestamp, any pos_bus index can be captured.
Pos bus fields have multiple modes that they can capture in.</p>
<div class="section" id="mode-0-value">
<h3>Mode 0 - Value<a class="headerlink" href="#mode-0-value" title="Permalink to this headline">¶</a></h3>
<p>This gives an instantaneous capture of value no matter what the state of GATE:</p>
<p>(<a class="reference external" href="../build/pcap_doc-4.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-4.png">png</a>, <a class="reference external" href="../build/pcap_doc-4.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-4.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-4.png" class="plot-directive" src="../_images/pcap_doc-4.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x50</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>100</td>
</tr>
<tr class="row-even"><td>2</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-1-difference">
<h3>Mode 1 - Difference<a class="headerlink" href="#mode-1-difference" title="Permalink to this headline">¶</a></h3>
<p>This is mainly used for something like an incrementing counter value.
It will only count the differences while GATE was high:</p>
<p>(<a class="reference external" href="../build/pcap_doc-5.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-5.png">png</a>, <a class="reference external" href="../build/pcap_doc-5.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-5.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-5.png" class="plot-directive" src="../_images/pcap_doc-5.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0xB1</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>-5</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-2-3-sum-lo-hi">
<h3>Mode 2/3 - Sum Lo/Hi<a class="headerlink" href="#mode-2-3-sum-lo-hi" title="Permalink to this headline">¶</a></h3>
<p>Mode 2 is the lower 32-bits of the sum of all samples while GATE was high:</p>
<p>(<a class="reference external" href="../build/pcap_doc-6.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-6.png">png</a>, <a class="reference external" href="../build/pcap_doc-6.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-6.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-6.png" class="plot-directive" src="../_images/pcap_doc-6.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x32</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>21</td>
</tr>
<tr class="row-even"><td>2</td>
<td>206</td>
</tr>
</tbody>
</table>
<p>Mode 2 and 3 together gives the full 64-bits of sum, needed for any sizeable
values on the pos_bus:</p>
<p>(<a class="reference external" href="../build/pcap_doc-7.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-7.png">png</a>, <a class="reference external" href="../build/pcap_doc-7.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-7.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-7.png" class="plot-directive" src="../_images/pcap_doc-7.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="36%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x22</th>
<th class="head">0x23</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>1073741824</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>-1073741824</td>
<td>0</td>
</tr>
<tr class="row-even"><td>2</td>
<td>-2147483648</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>-1073741824</td>
<td>-1</td>
</tr>
<tr class="row-even"><td>4</td>
<td>-1073741824</td>
<td>-2</td>
</tr>
</tbody>
</table>
<p>If long frame times (&gt; 2**32 SAMPLES, &gt; 30s), are to be used, then SHIFT_SUM
can be used to shift both the sum and SAMPLES field by up to 8-bits to
accomodate up to 125 hour frames. This example demonstrates the effect with
smaller numbers:</p>
<p>(<a class="reference external" href="../build/pcap_doc-8.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-8.png">png</a>, <a class="reference external" href="../build/pcap_doc-8.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-8.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-8.png" class="plot-directive" src="../_images/pcap_doc-8.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="33%" />
<col width="42%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x92</th>
<th class="head">0x260</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>40</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>36</td>
<td>1</td>
</tr>
<tr class="row-even"><td>2</td>
<td>-13</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-4-5-min-max">
<h3>Mode 4/5 - Min/Max<a class="headerlink" href="#mode-4-5-min-max" title="Permalink to this headline">¶</a></h3>
<p>Both of these modes calculate statistics on the value while GATE is high.</p>
<p>Mode 4 produces the min of all values or zero if the gate was low for all of the
current capture:</p>
<p>(<a class="reference external" href="../build/pcap_doc-9.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-9.png">png</a>, <a class="reference external" href="../build/pcap_doc-9.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-9.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-9.png" class="plot-directive" src="../_images/pcap_doc-9.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x84</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>20</td>
</tr>
<tr class="row-even"><td>2</td>
<td>21</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>2147483647</td>
</tr>
</tbody>
</table>
<p>Mode 5 produces the max of all values in a similar way:</p>
<p>(<a class="reference external" href="../build/pcap_doc-10.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-10.png">png</a>, <a class="reference external" href="../build/pcap_doc-10.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-10.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-10.png" class="plot-directive" src="../_images/pcap_doc-10.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x45</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>20</td>
</tr>
<tr class="row-even"><td>2</td>
<td>22</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>-2147483648</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="number-of-samples">
<h2>Number of samples<a class="headerlink" href="#number-of-samples" title="Permalink to this headline">¶</a></h2>
<p>There is a SAMPLES field that can be captured that will give the number of clock
ticks that GATE was high during a single CAPTURE. This field allows the TCP
server to offer “Mean” as a capture option, dividing “Sum” by SAMPLES to get
the mean value of the field during the capture period. It can also be captured
separately to give the gate length:</p>
<p>(<a class="reference external" href="../build/pcap_doc-11.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-11.png">png</a>, <a class="reference external" href="../build/pcap_doc-11.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-11.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-111.png" class="plot-directive" src="../_images/pcap_doc-111.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x260</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>3</td>
</tr>
<tr class="row-even"><td>2</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="timestamps">
<h2>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this headline">¶</a></h2>
<p>As well as the timestamp of the capture signal, timestamps can also be generated
for the start of each capture period (first gate high signal) and end (the tick
after the last gate high). These are again split into two 32-bit segments so
only the lower bits need to be captured for short captures. In the following
example we capture TS_START (0x20), TS_END (0x22) and TS_CAPTURE (0x24) lower
bits:</p>
<p>(<a class="reference external" href="../build/pcap_doc-12.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-12.png">png</a>, <a class="reference external" href="../build/pcap_doc-12.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-12.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-12.png" class="plot-directive" src="../_images/pcap_doc-12.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="28%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x200</th>
<th class="head">0x220</th>
<th class="head">0x240</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>4</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>4</td>
<td>8</td>
<td>9</td>
</tr>
<tr class="row-even"><td>2</td>
<td>11</td>
<td>13</td>
<td>13</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>-1</td>
<td>-1</td>
<td>16</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bit-bus-capture">
<h2>Bit bus capture<a class="headerlink" href="#bit-bus-capture" title="Permalink to this headline">¶</a></h2>
<p>The state of the bit bus at capture can also be captured. It is split into 4
quadrants of 32-bits each. For example, to capture signals 0..31 on the bit bus
we would use BITS0 (0x27):</p>
<p>(<a class="reference external" href="../build/pcap_doc-13.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-13.png">png</a>, <a class="reference external" href="../build/pcap_doc-13.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-13.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-13.png" class="plot-directive" src="../_images/pcap_doc-13.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x270</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>4</td>
</tr>
<tr class="row-even"><td>2</td>
<td>20</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>By capturing all 4 quadrants (0x27..0x2A) we get the whole bit bus:</p>
<p>(<a class="reference external" href="../build/pcap_doc-14.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-14.png">png</a>, <a class="reference external" href="../build/pcap_doc-14.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-14.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-14.png" class="plot-directive" src="../_images/pcap_doc-14.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x270</th>
<th class="head">0x280</th>
<th class="head">0x290</th>
<th class="head">0x2A0</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>4</td>
<td>67108864</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>2</td>
<td>4</td>
<td>67108864</td>
<td>0</td>
<td>32</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>1028</td>
<td>67108864</td>
<td>0</td>
<td>32</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="triggering-options">
<h2>Triggering options<a class="headerlink" href="#triggering-options" title="Permalink to this headline">¶</a></h2>
<p>ENABLE and GATE are level triggered, with ENABLE used for marking the start and
end of the entire acquisition, and GATE used to accept or reject samples within
a single capture from the acquisition. CAPTURE is edge triggered with an option
to trigger on rising, falling or both edges.</p>
<p>Triggering on rising is the default, explored in the preceding examples.
Triggering on falling edge would be used if you have a gate signal that
marks the capture boundaries and want sum or difference data within. For
example, to capture the amount POS[1] changes in each capture gate we could
connect GATE and CAPTURE to the same signal:</p>
<p>(<a class="reference external" href="../build/pcap_doc-15.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-15.png">png</a>, <a class="reference external" href="../build/pcap_doc-15.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-15.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-15.png" class="plot-directive" src="../_images/pcap_doc-15.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x11</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>-9</td>
</tr>
</tbody>
</table>
<p>Another option would be a gap-less acquisition of sum while gate is high
with capture boundaries marked with a toggle of CAPTURE:</p>
<p>(<a class="reference external" href="../build/pcap_doc-16.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-16.png">png</a>, <a class="reference external" href="../build/pcap_doc-16.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-16.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-16.png" class="plot-directive" src="../_images/pcap_doc-16.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x12</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>30</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>178</td>
</tr>
<tr class="row-even"><td>2</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="error-conditions">
<h2>Error conditions<a class="headerlink" href="#error-conditions" title="Permalink to this headline">¶</a></h2>
<p>The distance between capture signals must be at least the number of 32-bit
capture fields. If 2 capture signals are too close together HEALTH will be
set to 1 (Capture events too close together).</p>
<p>In this example there are 3 fields captured (TS_CAPTURE_L, TS_CAPTURE_H,
SAMPLES), but only 2 clock ticks between the 2nd and 3rd capture signals:</p>
<p>(<a class="reference external" href="../build/pcap_doc-17.py">Source code</a>, <a class="reference external" href="../build/pcap_doc-17.png">png</a>, <a class="reference external" href="../build/pcap_doc-17.hires.png">hires.png</a>, <a class="reference external" href="../build/pcap_doc-17.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/pcap_doc-17.png" class="plot-directive" src="../_images/pcap_doc-17.png" />
</div>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="28%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Row</th>
<th class="head">0x240</th>
<th class="head">0x250</th>
<th class="head">0x260</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>5</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pcomp_doc.html" class="btn btn-neutral float-right" title="PCOMP - Position Compare" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="outenc_doc.html" class="btn btn-neutral float-left" title="OUTENC - Output encoder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Diamond Light Source

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>